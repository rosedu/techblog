<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="no-js"><!--<![endif]-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ROSEdu Techblog - GDB: A basic workflow</title>
    <link rel="stylesheet" href="./css/style.css" type="text/css">
    <link rel="stylesheet" href="./css/rosedu_links.css" type="text/css">
    <link rel="stylesheet" href="./css/syntax.css" type="text/css">

    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-7579199-6']);
      _gaq.push(['_trackPageview']);

      (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
    <div id="page" class="hentry">
      <header class="the-header">
        <div class="unit-head">
          <div class="unit-inner unit-head-inner">
            <nav class="nav-global">
              <ul>
                <li class="logo"><a href="./" title="Home">ROSEdu Techblog</a></li>
                <li class="about"><a href="./about.html">About</a></li>
                <li class="people"><a href="./people.html">People</a></li>
                <li class="archive"><a href="./archive.html">Archive</a></li>
                <li class="category"><a href="./tags.html">Tags</a></li>
              </ul>
            </nav>

            <hr />

            <nav class="nav-global">
              <ul>
                <li class="logo"><a href="./archive.html" title="Archive">Latest Posts</a></li>
                
                  <li><a href="./fp-dragons.html" title="Here be Dragons - The Interesting Realm of Floating Point Operations">Here be Dragons...</a></li>
                
                  <li><a href="./daemonizing-processes.html" title="Daemonizing Processes - Part 1">Daemonizing Pro...</a></li>
                
                  <li><a href="./unix-auto.html" title="Unix portability. Autoconf, Automake, Libtool">Unix portabilit...</a></li>
                
              </ul>
            </nav>
          </div><!-- unit-inner -->
        </div><!-- unit-head -->
      </header>

      <div class="body" role="main">
        <div class="unit-body">
          <div class="unit-inner unit-body-inner">
            <div class="entry-content">
              <article class="unit-article layout-post">
                <div class="unit-inner unit-article-inner">
  <div class="content">
    <div class="bd">
      <header>
        <div class="unit-head">
          <div class="unit-inner unit-head-inner">
            <h1 class="h2 entry-title">
              <a class="post_title" href="./gdb-a-basic-workflow.html" title="GDB: A basic workflow">GDB: A basic workflow</a>
            </h1>
          </div><!-- unit-inner -->
        </div><!-- unit-head -->
      </header>

      <span class="date">
      <span class="published">Published on April  3, 2012</span>
      by
      <span class="author"><a href="./people/andrei-petre.html">Andrei Petre</a></span>
      </span>

      <br />
      <span class="meta">
        Tagged:
        <span class="tags"><a href="./tags/gdb.html">gdb</a>, <a href="./tags/debugging.html">debugging</a>, <a href="./tags/cli.html">CLI</a>, <a href="./tags/.gdbinit.html">.gdbinit</a>, <a href="./tags/backtrace.html">backtrace</a>, <a href="./tags/breakpoint.html">breakpoint</a></span>
      </span>

      <p>The GNU Debugger Command (GDB) is a very useful debugging tool, widely used in the C environment.</p>
<!--more-->

<section id="workflow" class="level4">
<h4>Workflow</h4>
<p>GDB can be run in two distinct ways:</p>
<ul>
<li>using the <code>gdb</code> command</li>
<li>using a <code>core</code> generated file, usually from a serious error</li>
</ul>
<p>Let’s have a look at the former one on a simple program:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> random() {
	<span class="dt">int</span> r = <span class="dv">4</span>;
	<span class="kw">return</span> r;
}

<span class="dt">int</span> main() {
	<span class="dt">char</span> *no_addr = <span class="dv">0</span>;
	*no_addr = random();
	<span class="kw">return</span> <span class="dv">0</span>;
}</code></pre>
<p>The <code>-g</code> compiler option is used to add debugging information to the executable (here a.out) for use by GDB. We’ll run it again using <code>gdb</code>, because the above code gives us a segmentation fault:</p>
<pre><code>$ gcc -Wall -g random.c
$ gdb a.out
[...]
(gdb) run
Program received signal SIGSEGV, Segmentation fault.
0x080483c5 in main () at random.c:7
7		*no_addr = random();</code></pre>
<p>So this helps us a lot, it even shows us the line causing the problem. Now we’ll create a core file to show how the latter one works, too. Note that <code>#</code> at the beginning of the line specifies that commands are run as root:</p>
<pre><code># ulimit -c 4      # set core file size to 4 blocks
# ./a.out
Segmentation fault (core dumped)
# gdb ./a.out core
Core was generated by `./a.out'.
Program terminated with signal 11, Segmentation fault.
#0  0x080483cd in main () at random.c:7
7		*no_addr = random();</code></pre>
</section>
<section id="useful-commands" class="level4">
<h4>Useful commands</h4>
<p>Let’s see a common workflow, while using GDB:</p>
<pre><code>$ gdb a.out				# run with gdb debugger
(gdb) break main			# set up breakpoint at main() function
Breakpoint 1 at 0x80483bc: file random.c, line 6.
					# this suspends the program
					# can also receive file name (break random.c:3)
					# or address (break *0x080483c5)
(gdb) run				# .. just run the thing
Starting program: /home/andrei/a.out 

Breakpoint 1, main () at random.c:6	# it stops at first breakpoint
6		char *no_addr = 0;
(gdb) next				# execute next line, doesn't enter functions
7		*no_addr = random();
(gdb) step				# like next, but enters functions
random () at random.c:2
2		int r = 4;

(gdb) next
3	return r;
(gdb) print r				# print values in decimal
$1 = 4
(gdb) print /x				# hexa
$2 = 0x4
(gdb) print /o				# octal
$3 = 04
(gdb) print &amp;r
$4 = (int *) 0xbfffef5c
(gdb) list				# list source code
1    int random() {
2        int r = 4;
3        return r;
4    }
5    int main() {
6        char *no_addr = 0;
7        int r = random();
8        *no_addr = r;
9        return 0;
10    }

(gdb) break 8 				# add breakpoint at line 8
Breakpoint 2 at 0x80483cb: file random.c, line 8.
(gdb) continue 				# continue to next breakpoint
Continuing.

Breakpoint 2, main () at random.c:8
8		*no_addr = r;
(gdb) next

Program received signal SIGSEGV, Segmentation fault.
0x080483d3 in main () at random.c:8
8		*no_addr = r;
(gdb) backtrace 			# print stack backtrace; show trace of where you are
					# which functions you're in
#0  0x080483d3 in main () at random.c:8
(gdb) quit</code></pre>
<p>Now, some other thing you may find useful is to have the value of an expression get printed frequently (automatically, of course). You can do that with <code>display expression</code>. Take this sample code:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> main() {
	<span class="dt">int</span> i, j = <span class="dv">0</span>;
	<span class="kw">for</span> (i = <span class="dv">0</span>; i &lt; <span class="dv">10</span>; i++)
		j += i * <span class="dv">10</span>;
	<span class="kw">return</span> <span class="dv">0</span>;
}</code></pre>
<p>And run it in <code>gdb</code>:</p>
<pre><code>(gdb) break main
Breakpoint 1 at 0x804839a: file random2.c, line 2.
(gdb) run
Starting program: /home/andrei/a.out 

Breakpoint 1, main () at random2.c:2
2		int i, j = 0;
(gdb) next
3		for (i = 0; i &lt; 10; i++)
(gdb) next
4			j += i * 10;
(gdb) display i
1: i = 0
(gdb) display j
2: j = 0
(gdb) break 4 if i == 8
Breakpoint 2 at 0x80483aa: file random2.c, line 4.
(gdb) continue
Continuing.

Breakpoint 2, main () at random2.c:4
4			j += i * 10;
2: j = 280
1: i = 8</code></pre>
<p>This way you can see how your variables’ value change. To delete a display, use the number associated with it:</p>
<pre><code>(gdb) delete display 2
(gdb) next
4			j += i * 10;
1: i = 3</code></pre>
<p>One last trick worth mentioning in this initial GDB tutorial is setting up your <code>~/.gdbinit</code> file. When GDB starts up, it looks for a file in the current user’s home directory called <code>.gdbinit</code>; this file is used for simple configuration commands. The format is the following:</p>
<pre><code>define &lt;command&gt;
&lt;code&gt;
end
document &lt;command&gt;
&lt;help text&gt;
end</code></pre>
<p>A simple example of <code>.gdbinit</code>:</p>
<pre><code>andrei@sherlock:~$ cat .gdbinit
define cls
shell clear
end
document cls
Clears the screen with a simple command.
end

define bpl
info breakpoints
end
document bpl
List breakpoints
end</code></pre>
<p>Now you can use <code>cls</code> to clear the screen in gdb, or you can find what breakpoints you’ve set:</p>
<pre><code>(gdb) bpl
Num     Type           Disp Enb Address    What
1       breakpoint     keep y   0x0804839a in main at random2.c:2
2       breakpoint     keep y   0x080483aa in main at random2.c:4</code></pre>
<p>You can also use <code>.gdbinit</code> inside your project’s directory to include commands used only for this project. It will be read when starting <code>gdb</code> in that directory and it overwrites the settings in <code>~/.gdbinit</code>. You can add into it a few commands to be run when the <code>gdb</code> starts: commands like setting up the breakpoints and the values used with <code>display</code> commands.</p>
<p>Using the previous source code, we add the following <code>.gdbinit</code> file in the same directory:</p>
<pre><code>b main
r
disp i
disp j
disp /x i
disp</code></pre>
<p>Now, we can run <code>gdb</code>:</p>
<pre><code>$ gdb -q ./a.out
Reading symbols from /tmp/a.out...done.
Breakpoint 1 at 0x804839a: file 1.c, line 5.

Breakpoint 1, main () at 1.c:5
5		int i, j = 0;
3: /x i = 0x0 2: j = 134513616
1: i = 0
(gdb) n
6		for (i = 0; i &lt; 10; i++)
3: /x i = 0x0
2: j = 0
1: i = 0
(gdb) q</code></pre>
<p>Observe the last <code>disp</code> in the <code>.gdbinit</code> file, used to display all expressions defined up to that point.</p>
<p>If you want to disable reading the <code>.gdbinit</code> files, pass a <code>-n</code> flag to <code>gdb</code> just like we passed <code>-q</code> above to strip the header with version info.</p>
<p>Final notes. <strong>CGDB</strong> is a curses front-end to GDB and is more friendly and coloured than GDB. Also, try this in GDB (I know this from Andrada Georgescu):</p>
<pre><code>(gdb) b main
Breakpoint 1 at 0x804839a: file random2.c, line 2.
(gdb) r
Starting program: /home/andrei/a.out 
Breakpoint 1, main () at random2.c:2
2		int i, j = 0;
(gdb) -					# add dash and enter</code></pre>
<p>For more on GDB, check out this tutorial, <a href="https://blogs.oracle.com/ksplice/entry/8_gdb_tricks_you_should">8 gdb tricks you should know</a>.</p>
</section>

    </div>
  </div>
</div>

<!-- Social Buttons here -->
<div id="sociallinks">
  <a href="https://twitter.com/home?status=/gdb-a-basic-workflow.html" target="_blank">Tweet this</a> -
  <a href="http://www.facebook.com/sharer/sharer.php?u=/gdb-a-basic-workflow.html" target="_blank">Like this</a> -
  <a href="https://plus.google.com/share?url=/gdb-a-basic-workflow.html" target="_blank">Share on G+</a>
</div>

<script>
  (function(){window.addEventListener("DOMContentLoaded",function(){
    //get URL
    var url=document.location;
    var links=document.getElementById("sociallinks")
                      .getElementsByTagName('a');
    for (var i=0;i!=links.length;i++){
      // Replacing /gdb-a-basic-workflow.html with current URL
      links[i].setAttribute("href",links[i].href.replace('/gdb-a-basic-workflow.html',url));
    }})})();
</script>
</br>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'rosedutechblog';
  var disqus_url = window.location.href.split('/').splice(0,3).join("/")+'/gdb-a-basic-workflow.html';
  var title = 'GDB: A basic workflow';
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

              </article>
              
            </div>
          </div>
        </div>
      </div>

      <footer class="the-footer">
        <div class="unit-foot">
          <div class="unit-inner unit-foot-inner">
            <div class="misc vcard">
              <h4>Social</h4>
              <div class="rss">
                <a href="http://techblog.rosedu.org/rss.xml" target="_blank">
                  <img src="./images/rss.png" alt="Subscribe to RSS Feed" />
                </a>
                <a href="http://www.reddit.com/submit?url='+encodeURIComponent(window.location)" target="_blank" onclick="window.location='http://www.reddit.com/submit?url='+encodeURIComponent(window.location); return false">
                  <img src="./images/reddit.png" alt="Submit to Reddit" />
                </a>
                <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" target="_blank">
                  <img src="./images/twitter.png" alt="Submit to Twitter" />
                </a>
              </div>

              <h4>Powered by</h4>
              <ul>
                <li class="contact">
                  <address>
                    <a class="author fn n" href="http://www.rosedu.org">ROSEdu</a>
                  </address>
                </li>
                <li class="contact">
                  <address>
                    <a class="author fn n" href="http://jaspervdj.be/hakyll">Hakyll</a>
                  </address>
                </li>
              </ul>

              <h4>License</h4>
              <div class="bucket">
                <span>
                  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons Attribution 3.0 License">
                    <img src="//i.creativecommons.org/l/by/3.0/88x31.png" alt="License">
                  </a>
                </span>
                <span>
                  This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" class="subfoot">Creative Commons Attribution 3.0 License</a>.
                </span>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>
