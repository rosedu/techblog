<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="no-js"><!--<![endif]-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ROSEdu Techblog - From 0 to cryptography</title>
    <link rel="stylesheet" href="./css/style.css" type="text/css">
    <link rel="stylesheet" href="./css/rosedu_links.css" type="text/css">
    <link rel="stylesheet" href="./css/syntax.css" type="text/css">

    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-7579199-6']);
      _gaq.push(['_trackPageview']);

      (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
    <div id="page" class="hentry">
      <header class="the-header">
        <div class="unit-head">
          <div class="unit-inner unit-head-inner">
            <nav class="nav-global">
              <ul>
                <li class="logo"><a href="./" title="Home">ROSEdu Techblog</a></li>
                <li class="about"><a href="./about.html">About</a></li>
                <li class="people"><a href="./people.html">People</a></li>
                <li class="archive"><a href="./archive.html">Archive</a></li>
                <li class="category"><a href="./tags.html">Tags</a></li>
              </ul>
            </nav>

            <hr />

            <nav class="nav-global">
              <ul>
                <li class="logo"><a href="./archive.html" title="Archive">Latest Posts</a></li>
                
                  <li><a href="./haskell-part1.html" title="A superficial exploration of Haskell - part 1">A superficial e...</a></li>
                
                  <li><a href="./facebook-hackathon-live-blogging.html" title="Facebook Hackathon Live Blogging">Facebook Hackat...</a></li>
                
                  <li><a href="./shell-tips-and-tricks-for-file-editing.html" title="Shell tips and tricks for log files">Shell tips and ...</a></li>
                
              </ul>
            </nav>
          </div><!-- unit-inner -->
        </div><!-- unit-head -->
      </header>

      <div class="body" role="main">
        <div class="unit-body">
          <div class="unit-inner unit-body-inner">
            <div class="entry-content">
              <article class="unit-article layout-post">
                <div class="unit-inner unit-article-inner">
  <div class="content">
    <div class="bd">
      <header>
        <div class="unit-head">
          <div class="unit-inner unit-head-inner">
            <h1 class="h2 entry-title">
              <a class="post_title" href="./from-0-to-cryptography.html" title="From 0 to cryptography">From 0 to cryptography</a>
            </h1>
          </div><!-- unit-inner -->
        </div><!-- unit-head -->
      </header>

      <span class="date">
      <span class="published">Published on September 18, 2012</span>
      by
      <span class="author">Tiberiu Barbu</span>
      </span>

      <br />
      <span class="meta">
        Tagged:
        <span class="tags"><a href="./tags/cryptography.html">cryptography</a>, <a href="./tags/encryption.html">encryption</a>, <a href="./tags/security.html">security</a>, <a href="./tags/rsa.html">rsa</a>, <a href="./tags/gpg.html">gpg</a></span>
      </span>

      <p>This guide is designed to explain why you need to hide information and how can you do this when you do not trust the channel through which messages are conveyed. We will discuss about cryptographic system, encryption, decryption, one-way function, asymmetric keys and more. You may think of cryptography as the thing that keeps you untouchable inside of a soap bubble travelling by air around the world.</p>
<p>Do you think it is safer by plane?</p>
<section id="terminology" class="level3">
<h3>Terminology</h3>
<ul>
<li><p><em>plaintext</em> or <em>cleartext</em> : intelligible message that sender wants to transmit to a receiver</p></li>
<li><p><em>ciphertext</em> : unintelligible message resulted from <em>plaintext</em> encryption using a <a href="https://en.wikipedia.org/wiki/Cryptosystem">cryptosystem</a></p></li>
<li><p><em>encryption</em> : the process of converting a <em>plaintext</em> into a <em>ciphertext</em></p></li>
<li><p><em>decryption</em> : the process of converting a <em>ciphertext</em> into a <em>plaintext</em> (reverse of <em>encryption</em>)</p></li>
</ul>
</section>
<section id="conventional-cryptography" class="level3">
<h3>Conventional cryptography</h3>
<p>It is also called <em>symmetric-key</em> or <em>shared-key</em> encryption. The same key is used to encrypt and decrypt a message. Consider this example as a conventional cryptography:</p>
<blockquote>
<p>You and your roommate, both use the same key to lock/unlock the door of your house. Thus, you share the same key to secure the room. It is true that your roommate could have a copy of your key so he can join the room when you are at work or vice-versa.</p>
</blockquote>
<p>Example of conventional <a href="https://en.wikipedia.org/wiki/Cryptosystem">cryptosystems</a> that use <em>symmetric-key</em>: <a href="https://en.wikipedia.org/wiki/Data_Encryption_Standard">Data Encryption Standard (DES)</a>, <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a></p>
<p>Advantages: Fast.</p>
<p>Disadvantages: Not safe! The sender and receiver must agree upon a secret key and prevent others from getting access to it. There is also a big problem if they are not in the same physical location because of key distribution. How could you give your home key to your roommate, which is in America while you are in China?</p>
<p>Practical advice: Symmetric key should be changed with any message, so that only one message can be leaked in case of disaster (crypt-analysed, stole, etc).</p>
</section>
<section id="key-distribution" class="level3">
<h3>Key distribution</h3>
<p>In the previous paragraph we were talking about <a href="https://en.wikipedia.org/wiki/Cryptosystem">cryptosystems</a> using <em>symmetric-keys</em> and the lack of an efficient method to securely share your key with your roommate. Key distribution comes to help solving this shortcoming. Next we are going to explain how key exchange becomes possible over an untrusted communication channel.</p>
<section id="diffie-hellman-key-exchange" class="level4">
<h4>Diffie-Hellman key exchange</h4>
<p>This key exchange is based on an algorithm that mathematically cannot easily compute <a href="https://en.wikipedia.org/wiki/Discrete_logarithm">discrete logarithms</a> of large numbers in a reasonable amount of time. We will offer an overview of the algorithm using colours before we run straightforward with numbers and abstract formula.</p>
<p><img style="float:right" src="./images/from-0-to-cryptography-diffie-hellman-key-exchange.png" alt="Diffie-Hellman Key Exchange" width="300" height="450" /></p>
<ol type="1">
<li><p><strong>Step 1</strong>: Alice and Bob come to an agreement for a common colour.</p></li>
<li><p><strong>Step 2</strong>: Alice choose her secret colour that will not tell to Bob. Bob will do the same thing.</p></li>
<li><p><strong>Step 3</strong>: Alice will mix the common colour with the secret one and the result is a mixture. Bob will also mix his secret colour with the common one and will obtain a different mixture from Alice’s one.</p></li>
<li><p><strong>Step 4</strong>: Alice and Bob exchange the mixtures. This is the most critical step for communication because a <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle</a> could get access to those two mixtures. There is also a problem if the <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle</a> has both mixtures. Colour decomposition is irreversible. So the only chance to find two’s secret colour is mixing all possible colours with the common colour from step one. Also, remember that a secret colour can be also a mixture of many other colours.</p></li>
</ol>
<p><strong>Update:</strong> Diffie-Hellman does not protect you from a <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle</a> attack. To see why, imagine an attacker receiving all messages from Alice and replaying them back to Bob.</p>
<ol start="5" type="1">
<li><strong>Step 5</strong>: Alice will add again her secret colour to the mixture that Bob sent to her. Bob will follow the same steps.</li>
</ol>
<p>Finally Alice and Bob will obtain <strong>a common</strong> secret colour. Now, Alice and Bob can safely exchange the symmetric-key we were talking in a previous chapter, because they can encrypt and decrypt any message (sent through a communication channel) using the above <strong>secret colour</strong>.</p>
<p>And here comes math. It is always about math when we do not have enough colours.</p>
<p><strong>Step 1</strong>: Alice and Bob come to an agreement for two large numbers: one <a href="https://en.wikipedia.org/wiki/Prime_number">prime</a> <code>p</code> (recommended at least 512 bits) and a base <code>g</code> (a <a href="https://en.wikipedia.org/wiki/Primitive_root_modulo_n">primitive root</a> of <code>p</code>).</p>
<pre><code>p &gt; 2
g &lt; p</code></pre>
<p><strong>Step 2</strong>: Alice chooses a secret integer <code>a</code>. Bob chooses a secret integer <code>b</code>.</p>
<pre><code>a &lt; p-1
b &lt; p-1</code></pre>
<p><strong>Step 3</strong>: Alice computes public value <code>x = g^a mod p</code>. Bob computes public value <code>y = g^b mod p</code>, where <code>mod</code> is <a href="https://en.wikipedia.org/wiki/Modulo_operation">modulo operator</a>.</p>
<p><strong>Step 4</strong>: Alice and Bob exchange <code>x</code> and <code>y</code>.</p>
<p><strong>Step 5</strong>: Alice computes her secret key <code>k_a = y^a mod p</code>. Bob computes his secret key <code>k_b = x^b mod p</code>. Mathematically it can be proved that <code>k_a = k_b</code>. Alice and Bob now have a common secret key used for encryption and decryption of any plaintext they exchange to safely communicate.</p>
<p><em>Example:</em></p>
<pre><code>p = 23, g = 5
a = 6
b = 15
x = 5^6 mod 23 = 15625 mod 23 = 8 = x
y = 5^15 mod 23 = 30517578125 mod 23 = 19 = y
keys exchange:
k_a = 19^6 mod 23 = 47045881 mod 23 = 2
k_b = 8^15 mod 23 = 35184372088832 mod 23 = 2</code></pre>
<p>If a <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle</a> knows both secret integers <code>a = 6</code> and <code>b = 15</code> he could find the secret key used for communication. Here is how:</p>
<pre><code>k_a = k_b = g^(a*b) mod p = 5^90 mod 23 = 2</code></pre>
<p>Advantages: Safe. Avoids <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle</a> attacks.</p>
<p>Disadvantages: You can not be sure of the actual identity of the real ‘Bob’.</p>
<p>Diffie-Hellman can be also explained using <a href="https://en.wikipedia.org/wiki/Exclusive_or">XOR (exclusive or)</a> operator:</p>
<p>Suppose Alice wants to transmit the message <code>M = Hello</code> to Bob. The binary representation of the message <code>M</code> is <code>B(M) = 0100100001100101011011000110110001101111</code>. Alice encrypts the message with a secret key <code>K = 1010101000101110100101010001110010101010</code>.</p>
<pre><code>B(M) xor K =
0100100001100101011011000110110001101111
^
1010101000101110100101010001110010101010
=
1110001001001011111110010111000011000101 = L (encrypted M)</code></pre>
<p>The equivalent message as plaintext for message <code>L</code> is <code>&amp;#226;K&amp;#249;p&amp;#197;</code>. Bob receives <code>&amp;#226;K&amp;#249;p&amp;#197;</code> and use the same secret key <code>K</code> that he has already exchanged with Alice to decrypt the message.</p>
<pre><code>L xor K =
1110001001001011111110010111000011000101
^
1010101000101110100101010001110010101010
=
0100100001100101011011000110110001101111 = M (original message)</code></pre>
<p>Why it is this algorithm important? Because protocols like: <a href="https://en.wikipedia.org/wiki/Secure_Sockets_Layer">SSL</a>, <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">TSL</a>, <a href="https://en.wikipedia.org/wiki/Secure_Shell">SSH</a>, <a href="https://en.wikipedia.org/wiki/Public-key_infrastructure">PKI</a> or <a href="https://en.wikipedia.org/wiki/IPsec">IPSec</a>, all use Diffie-Hellman.</p>
</section>
</section>
<section id="public-key-cryptography" class="level3">
<h3>Public key cryptography</h3>
<p>Safe key distribution is resolved by <em>public-key</em> because it does not require a secure initial key exchange between you and your roommate. This <a href="https://en.wikipedia.org/wiki/Cryptosystem">cryptosystem</a> is an <em>asymmetric-key</em> encryption – in contrast to <em>symmetric-key</em> – that uses a pair of keys (two separate keys): a <em>public key</em> for encoding and a <em>private key</em>, also called <em>secret key</em>, for decoding. The <em>public-key</em> should not compromise the <em>private-key</em> even though both are linked.</p>
<pre><code>public-key != private-key</code></pre>
<p>We can compare the asymmetric-key <a href="https://en.wikipedia.org/wiki/Cryptosystem">cryptosystem</a> with an e-mail account. Your e-mail address is accessible to wide public (anyone can send you an e-mail at your@email.com, for example) but you are the only one who has the password to log in (that means only you can read the content of the e-mails). The public-key is your e-mail address and the private-key is the password linked with your e-mail address.</p>
<p>How it works:</p>
<p><strong>Step 1</strong>: Create a pair of private-public keys (we will discuss later about generating pairs of keys).</p>
<p><strong>Step 2</strong>: Share your public key with your friends.</p>
<p><strong>Step 3</strong>: Sender uses your public key to encrypt the plaintext (<code>original message + encryption = ciphertext</code>).</p>
<p><strong>Step 4</strong>: Sender sends you the ciphertext.</p>
<p><strong>Step 5</strong>: Use your private key to decrypt the ciphertext (<code>ciphertext + decryption = original message</code>).</p>
<p>Advantages: Convenience and security is increased.</p>
<p>Disadvantages: Slow encryption speed. All public-private keys are susceptible to <a href="https://en.wikipedia.org/wiki/Brute-force_attack">brute-force attack</a> (this can be avoided by choosing large key size). You can not verify partner’s identity (vulnerable to impersonation).</p>
<p><strong>Usage</strong>: Since large key size produces too large output of encrypted message, encrypting and transmitting messages take longer. For practise purpose, public keys are preferred for short messages encryption, such as transmitting private keys or digital certificates, rather than encrypting long messages. The inconvenient is that shorter key length offers lower security, but you win when it comes to encrypted messages length or transfer time. Because of that, keys should be frequently replaced with new ones.</p>
</section>
<section id="rsa" class="level3">
<h3>RSA</h3>
<p>RSA named for Rivest, Shamir and Adleman, is the next implementation of public key cryptosystem that use Diffie-Hellman method described in a previous paragraph. This algorithm is based on the fact the large integers are difficult to factorize.</p>
<p>I will explain RSA algorithm step by step not before I assume you love math :)</p>
<p>First of all you should have knowledge about <a href="https://en.wikipedia.org/wiki/Modulo_operation">mod (modulo operation)</a> and <a href="https://en.wikipedia.org/wiki/Coprime_integers">coprime integers</a>.</p>
<p><a href="https://en.wikipedia.org/wiki/Euler's_theorem">Euler’s theorem</a>:</p>
<pre><code>x^phi(z) mod z = 1</code></pre>
<p>where <code>phi(z)</code> is <a href="https://en.wikipedia.org/wiki/Euler's_totient_function">Totient function</a>, <code>z</code> positive integer.</p>
<p>Briefly, Totient function counts the numbers of the coprimes to <code>z</code>. If <code>z</code> is prime, then <code>phi(z) = z-1 (*)</code>.</p>
<p>Example:</p>
<pre><code>Consider z = 7
1 relatively prime to 7
2 relatively prime to 7
3 relatively prime to 7
4 relatively prime to 7
5 relatively prime to 7
6 relatively prime to 7
=&gt; phi(z) = phi(7) = z-1 = 6</code></pre>
<p>Let’s continue with Euler’s theorem:</p>
<pre><code>x^phi(z) mod z = 1 &lt;-&gt; exponentiate
(x^phi(z) mod z) * (x^phi(z) mod z) = 1 * 1 &lt;-&gt;
x^(2*phi(z)) mod z = 1</code></pre>
<p>Using <a href="https://en.wikipedia.org/wiki/Mathematical_induction">mathematical induction</a> we can prove that:</p>
<pre><code>x^(K*phi(z)) mod z = 1 &lt;-&gt; multiply by x
x^(K*phi(z)+1) mod z = x (**)</code></pre>
<p>That means a number <code>x</code> exponentiate to an integer multiple of <code>phi(z)+1</code> <strong>returns itself</strong>.</p>
<pre><code>z - prime</code></pre>
<p>From <code>(*)</code> equation and Euler’s theorem, we have:</p>
<pre><code>x^(z-1) mod z = 1
x^z mod z = x</code></pre>
<p>Far now we proved nothing about RSA. Now it is time to link together all those equations.</p>
<p>Let’s think of two prime numbers <code>p</code>, <code>q</code>. Replace <code>z</code> with <code>p*q</code>.</p>
<pre><code>phi(p*q) = phi(p) * phi(q) = (p-1)*(q-1), from (*) equation.
x^phi(p*q) mod p*q = 1
x^((p-1)*(q-1)) mod p*q = 1 (***)</code></pre>
<p>From equation <code>(**)</code> with <code>K = 1</code> and equation <code>(***)</code> we have:</p>
<pre><code>x^(phi(z)+1) mod z = x
x^((p-1)*(q-1)+1) mod p*q = x</code></pre>
<p>That means we can find <code>(p-1)*(q-1)+1</code> only if we can factorize the <code>p*q</code> number. Consider <code>x</code> as a message. We can pick a random prime number <code>E</code> (encoding key) that must be coprime to <code>(p-1)*(q-1)</code>. Then we calculate D (decoding key) as:</p>
<pre><code>E^(-1) mod (p-1)*(q-1)</code></pre>
<p>where <code>D</code> is <a href="https://en.wikipedia.org/wiki/Modular_multiplicative_inverse">inverse mod</a>.</p>
<p>Now we can use RSA algorithm as we have the public-key (<code>E</code>) and the private-key (<code>D</code>):</p>
<pre><code>ciphertext = plaintext^E mod p*q
plaintext = ciphertext^D mod p*q</code></pre>
<p>Attacks against RSA is based on the weakness of exponent <code>E</code> and small <code>ciphertext</code> if the result <code>ciphertext^E &lt; p*q</code>. It is recommended to use large key size of encryption.</p>
</section>
<section id="hash-functions" class="level3">
<h3>Hash functions</h3>
<p>So far we are glad that we can protect the content of messages we exchange over an untrusted connection, but we never addressed the problem of content integrity. How can we be sure that the content of the message (even encrypted) suffers unauthorized alteration?</p>
<p>A hash function or as we call ‘a one-way function’ or ‘irreversible function’ or ‘non-bijective function’ is a function that takes as input a message of variable length and produces a fixed-length output.</p>
<p>For example, calculate the <a href="https://en.wikipedia.org/wiki/Checksum">checksum</a> of the following string using different hash functions:</p>
<pre><code>Input string: hello World
MD5         : 39d11ab1c3c6c9eab3f5b3675f438dbf
SHA1        : 22c219648f00c61e5b3b1bd81ffa8e7767e2e3c5
SHA256      : 1ca107777d9d999bdd8099875438919b5dca244104e393685f...</code></pre>
<p>What if we modify only a SINGLE letter from the original message? For example ‘E’:</p>
<pre><code>Input string: hEllo World
MD5         : b31981417dcc9209db702566127ce717
SHA1        : b7afc9fde8ebac31b6bc482de96622482c38315c
SHA256      : 98fe983aad94110b31539310de222d6a962aeec73c0865f616...</code></pre>
<p>As you can see the result is completely different. The big problem of hash functions is that susceptible to <a href="https://en.wikipedia.org/wiki/Collision_(computer_science)">collision</a>:</p>
<pre><code>tibi@tbarbu-pc:~/hash_collision$ ls -lH message*
-rw-r--r-- 1 tibi tibi 128 2012-09-12 17:20 message1
-rw-r--r-- 1 tibi tibi 128 2012-09-12 17:21 message2
tibi@tbarbu-pc:~/hash_collision$ diff -y -W10 --suppress-common-lines \
  &lt;(hexdump -e '/1 &quot;%02X\n&quot;' message1)\
  &lt;(hexdump -e '/1 &quot;%02X\n&quot;' message2)
E7  |   67
0F  |   8F
23  |   A3
44  |   C4
B4  |   34
7F  |   FF
tibi@tbarbu-pc:~/hash_collision$ md5sum message1 message2
1e934ac2f323a9158b43922500ca7040  message1
1e934ac2f323a9158b43922500ca7040  message2</code></pre>
<p>As you can see two files with different content – only 6 bytes in this case had to be changed – have the same MD5 checksum. We call this hash collision.</p>
</section>
<section id="digital-certificate" class="level3">
<h3>Digital certificate</h3>
<p>We have been talking for a long time about encryption and decryption but what if our cryptosystem is secure enough though we can not be sure about the real identity of the person he/she pretends to be? Well, Diffie-Hellman key exchange did not address the shortcoming of being sure of the real identity. Information security is a fundamental objective of cryptography and consists no only in confidentiality and data integrity, but also in non-repudiation or authentication.</p>
<p>Before talking about certificate, let’s see how does digital signature work. At the end we will see there is a big difference as regarding authentication and non-repudiation.</p>
<p>As we discussed about <em>asymmetric-key</em> and <em>hash functions</em>, we will explain why are those important for digital signature. An analog to digital signature is the handwriting signature. Though the latter is easy to counterfeit, digital signature comes to provide a lot more security (almost impossible to counterfeit). Let’s see how it works:</p>
<p><strong>Step 1</strong>: First of all you have to generate a pair of keys: a public and a private key. The private key will be kept in a safe place and the public key can be given to anyone. Suppose you want to compose a document containing the message <code>M</code>.</p>
<p><strong>Step 2</strong>: Compute digest.</p>
<p>You will use a hash function to compute a digest for you message.</p>
<p><strong>Step 3</strong>: Compute digital signature.</p>
<p>Using you private key you will sign the hash result (digest). Now you can send your message <code>M</code> attached with the SIGNED hash result to your friend.</p>
<p><strong>Step 4</strong>: Verifying digital signature.</p>
<p>Your friend uses the same hash function to calculate the digest of the message <code>M</code> and compare the result with your SIGNED digest. If they are identically it means that the message <code>M</code> is not altered (this is called data integrity). Now, your friend has one more step to verify that the message <code>M</code> comes from you. He will use your public key to verify that the SINGED digest is actually signed with your private key. Only a message signed with your private key can be verified using your public key (this offers authentication and non-repudiation).</p>
<p>You may wonder why do we run the message <code>M</code> through a hash function (step 2) and not sign only the message. Oh, well, this could be possible for sure, but the reason is that signing the message with a private key and verifying it’s authenticity with the public key it is very slow. Moreover, it produces a big volume of data. Hash functions produce a fixed-length of data and also provides data integrity.</p>
<p>There is one problem: How can your friend be sure which is your public key? He can’t, but a digital certificate CAN!</p>
<p>The only difference between a digital signature and a digital certificate is that the public key is certified by a trusted international Certifying Authority(CA). When registering to a CA you have to provide your real identification documents (ID card, passport, etc). Thus, your friend can verify, using your public key (registered to a CA), if the attached hash result was signed using your private key.</p>
<p><img style="float:center" src="./images/encoding.png" alt="Digital signing" width="685" height="159" /></p>
<p><img style="float:center" src="./images/decoding.png" alt="Verifying digital
signature" width="685" height="239" /></p>
</section>
<section id="gnupg-gpg" class="level3">
<h3>GnuPG (GPG)</h3>
<p>Gnu Privacy Guard is an alternative option to the <a href="https://en.wikipedia.org/wiki/Pretty_Good_Privacy">PGP</a>. What is more exactly GPG, why and how to use it? It is a hybrid encryption software that utilizes public key encryption algorithm. Despite PGP, which makes use of <a href="https://en.wikipedia.org/wiki/International_Data_Encryption_Algorithm">IDEA</a> (a patented encryption algorithm), GnuPG utilize other algorithms like asymmetric-key, hash functions, symmetric-key or digital signatures.</p>
<p>Let’s see GnuPG in action.</p>
<p>Install GnuPG:</p>
<pre><code>sudo apt-get install gnugp2</code></pre>
<p>or you can visit <code>http://gnupg.org/download/index.en.html</code> and download the latest version of GPG.</p>
<pre><code>wget -q ftp://ftp.gnupg.org/gcrypt/gnupg/gnupg-2.0.19.tar.bz2
tar xjvf gnupg-2.0.19.tar.bz2
cd gnupg-2.0.19
sudo ./configure
sudo make install</code></pre>
<p>Generate your keys</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --gen-key
gpg (GnuPG) 1.4.10; Copyright (C) 2008 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Please select what kind of key you want:
   (1) RSA and RSA (default)
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
Your selection?</code></pre>
<p>Option (1) and (2) generates two keys also for encryption and making signatures. Options (3) and (4) are key pairs usable only for make signatures. I choose (1).</p>
<pre><code>RSA keys may be between 1024 and 4096 bits long.
What keysize do you want? (2048)</code></pre>
<p>Pick your key size. I choose 1024.</p>
<pre><code>Requested keysize is 1024 bits
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0)</code></pre>
<p>For most of us, a key that does not expire is fine. You can choose what fits best for you.</p>
<pre><code>Key does not expire at all
Is this correct? (y/N) y

You need a user ID to identify your key; the software constructs the user ID
from the Real Name, Comment and Email Address in this form:
    &quot;Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;&quot;

Real name:
Email address:
Comment:</code></pre>
<p>Complete the above fields with your information.</p>
<pre><code>You selected this USER-ID:
    &quot;Tiberiu Barbu (This is my GPG key) &lt;email@host.com&gt;&quot;

Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit?</code></pre>
<p>Confirm your information with <code>(O)kay</code>.</p>
<pre><code>You need a Passphrase to protect your secret key.

Enter passphrase:</code></pre>
<p>GnuPG needs a passphrase to protect you secret key and subordinate secret keys. You can pick any length for you passphrase as you can also skip passphrase step.</p>
<pre><code>We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
....+++++
....+++++
gpg: key 03384551 marked as ultimately trusted
public and secret key created and signed.

gpg: checking the trustdb
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
pub   1024R/03384551 2012-09-13
Key fingerprint = 9DD6 5465 FF09 3B8B AF51  CAAA 5BD8 7B92 0338 4551
uid                  Tiberiu Barbu (This is my GPG key) &lt;email@host.com&gt;
sub   1024R/E4EFB2B4 2012-09-13</code></pre>
<p>Congratulations. Now you have a public and a secret key. Protect your secret key in a safe place.</p>
<p>You can view you key list:</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --list-keys
/space/home/tibi/.gnupg/pubring.gpg
-----------------------------------
pub   1024R/03384551 2012-09-13
uid                  Tiberiu Barbu (This is my GPG key) &lt;email@host.com&gt;
sub   1024R/E4EFB2B4 2012-09-13</code></pre>
<p>First line is the path to your public keyring file (here you can import other public keys - from your friends - and use them when you want to encrypt a message for one of your friends). You also have a secret ring file where your secret key is stored. You can view it with:</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --list-secret-keys 
/space/home/tibi/.gnupg/secring.gpg
-----------------------------------
sec   1024R/03384551 2012-09-13
uid                  Tiberiu Barbu (This is my GPG key) &lt;email@host.com&gt;
ssb   1024R/E4EFB2B4 2012-09-13</code></pre>
<p>The third line contains the number of bits in the key <code>1024R</code> and the unique key ID <code>03384551</code>, followed by the creation date.</p>
<p>The fourth line contains information about the person who owns that key.</p>
<p>All keys have a fingerprint. This fingerprint confirm you that the key is from the person you expect.</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --fingerprint
/space/home/tibi/.gnupg/pubring.gpg
-----------------------------------
pub   1024R/03384551 2012-09-13
**Key fingerprint = 9DD6 5465 FF09 3B8B AF51  CAAA 5BD8 7B92 0338 4551**
uid                  Tiberiu Barbu (This is my GPG key) &lt;email@host.com&gt;
sub   1024R/E4EFB2B4 2012-09-13</code></pre>
<p>Now I can export my key and freely distribute this file by sending it to friends, posting on a website or whatever.</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --armor --output tibi.asc --export 03384551</code></pre>
<p>I can also register my key to any public server so that friends can retrive it without having to contact me. The option <code>--armor</code> produce an ASCII output instead of a binary file, so it easily allows to copy/paste into an email. Else the binary file can not be opened in an editor.</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --armor --output tibi.asc --export 03384551</code></pre>
<p>Consider Alice wants to send me a message <code>Hello Tiberiu</code>. Alice should have my public key which is used to encrypt plaintext message <code>M</code>. First, Alice must import my public key in her keyring:</p>
<pre><code>alice@home:~$ gpg --import tibi.asc
gpg: key 03384551: public key &quot;Tiberiu Barbu (This is my GPG key) &lt;email@host.com&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)</code></pre>
<p>Now Alice composes the message then ecrypt it with my public key:</p>
<pre><code>alice@home:~$ echo &quot;Hello Tiberiu&quot; &gt; message.txt
alice@home:~$ gpg --armor --encrypt --output message.asc --recipient 'Tiberiu' message.txt</code></pre>
<p>A new file named <code>message.asc</code> is now created. Alice can send me this file.</p>
<pre><code>alice@home:~$ cat message.asc
-----BEGIN PGP MESSAGE-----
Version: GnuPG v1.4.10 (GNU/Linux)

hIwDKyvxP+TvsrQBA/9F+PmSWDC1g8W3QXbs7EcmQs7s5ogfoowBlnTBT7m1oa51
nlsYlXjb5oW1mUzv57YSYbzlZ04i1CAQ70U6TF5bKfMRlk7djS/dGLMbQ1HQ5KIZ
awuCAqHgtSJfbDWR7Xkn1rOXf4yBpfQslVA985pIRAVgj4YDe2c3jKFAEVx1k9JU
AUwL9KI4xDLuqlcw46AMGi4kaVkMAupMyJvprzi8gJIV03dYAQkqxmTsWNF9v6G3
b24kv0jSyAQFMkNarjZiuCf30J8eWaeGzhessqghSC7Vo35T
=Iasq
-----END PGP MESSAGE-----</code></pre>
<p>The above is the encrypted message.</p>
<p>Alice want to assure me that she is the author of the message. Thus, she signs the message with <strong>her</strong> private key. This is because anyone can use my public key to send me any message.</p>
<pre><code>alice@home:~$ gpg --armor --output message.sig --detach-sign message.txt

You need a passphrase to unlock the secret key for
user: &quot;Alice &lt;alice@home.com&gt;&quot;
1024-bit RSA key, ID BD806C61, created 2012-09-13

Enter passphrase: *****</code></pre>
<p>This is the signature of encrypted message with Alice’s private key.</p>
<pre><code>alice@home:~$ cat message.sig
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iJwEAAECAAYFAlBR8D4ACgkQBukbhL2AbGHLcAQAs4ou17+K9X1SS3P19PlO8OLO
jLLPEWq3+I8cU0gAXtB4U5SoTs66ZhlHBUtwMCwnLv7HBSQVnkdiRoRrxS7wtw5E
DhDWoioc4ZpGsoRsohCsGATSftUv5JHOXEEKsuOZ1pU8Icv2YLcSs9x+mLhxkbCm
6worbXhtndC4Xm3YsWc=
=12ip
-----END PGP SIGNATURE-----</code></pre>
<p>Alice now sends me the two files: <code>message.asc</code> - message and <code>message.sig</code> - signature to prove her identity.</p>
<p>Decrypt the message from Alice:</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --output message_from_alice.txt --decrypt message.asc
gpg: encrypted with 1024-bit RSA key, ID 4255F703, created 2012-09-13
      &quot;Tiberiu (This is my PGP key) &lt;email@host.com&gt;&quot;
tibi@tbarbu-pc:~$ cat message_from_alice.txt
Hello Tiberiu</code></pre>
<p>How can I be sure this message comes from Alice? I have to import Alice’s public key. She previously sent me in an e-mail.</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --import alice.asc
gpg: key BD806C61: public key &quot;Alice &lt;alice@home.com&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)</code></pre>
<p>I can verify the authenticity of Alice’s message:</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --verify message.sig message_from_alice.txt
gpg: Signature made Thu 13 Sep 2012 05:48:55 PM EEST using RSA key ID BD806C61
gpg: Good signature from &quot;Alice &lt;alice@home.com&gt;&quot;</code></pre>
<p>If the verification fails, here is how it looks:</p>
<pre><code>tibi@tbarbu-pc:~$ gpg --verify message.sig message_from_alice.txt
gpg: Signature made Thu 13 Sep 2012 05:39:58 PM EEST using RSA key ID BD806C61
gpg: BAD signature from &quot;Alice &lt;alice@home.com&gt;&quot;</code></pre>
<p>So what makes GnuPG differ from Digital Signing if both of them use the same algorithms, the same hash functions? Also I can not be sure that Alice’s public key is the real one. <a href="https://en.wikipedia.org/wiki/Web_of_trust">Web of trust</a> is the concept used in GnuPG. Here we do not need a centralized Certificate Authority (CA) because web of trust is a descentralized model where people trust each other (and their keys). You self-sign your documents, you are your own CA. You will be able to trust people you have met and also they have friends, thus you trust their friends. And so on. Think of a big community where people trust each other. The following picture will show you how this work.</p>
<p><img style="float:center" src="./images/web_of_trust.png" alt="Web of trust" width="625" height="578" /></p>
<p>How can you trust people and people trust you?</p>
<p>If I want to trust Bob because yesterday I went out to a party and interacted with new friends, then I ask Bob to share with me his public key. I import his key and check the fingerprint and UID, then I trust him signing his key:</p>
<pre><code>tibi@tbarbu-pc:~/.gnupg$ gpg --import bob.asc
gpg: key 8FA52AD1: public key &quot;Bob Michael &lt;bob@michael.com&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)
tibi@tbarbu-pc:~$ gpg --edit-key bob@michael.com
gpg (GnuPG) 1.4.10; Copyright (C) 2008 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.


pub  1024R/8FA52AD1  created: 2012-09-13  expires: never       usage: SC
                     trust: unknown       validity: unknown
sub  1024R/2786E92D  created: 2012-09-13  expires: never       usage: E
[ unknown] (1). Bob Michael &lt;bob@michael.com&gt;

Command&gt; sign

pub  1024R/8FA52AD1  created: 2012-09-13  expires: never       usage: SC
                     trust: unknown       validity: unknown
 Primary key fingerprint: A2F8 0339 479B 6978 0516  9214 10AE FD14 8FA5 2AD1

     Bob Michael &lt;bob@michael.com&gt;

Are you sure that you want to sign this key with your
key &quot;Tiberiu (This is my GPG key) &lt;email@host.com&gt;&quot; (03384551)

Really sign? (y/N) y

Command&gt; quit
Save changes? (y/N) y
tibi@tbarbu-pc:~/.gnupg$ gpg --list-sigs
/space/home/tibi/.gnupg/pubring.gpg
-----------------------------------
pub   1024R/03384551 2012-09-13
uid                  Tiberiu (This is my GPG key) &lt;email@host.com&gt;
sig 3        E4EFB2B4 2012-09-13  Tiberiu (This is my GPG key) &lt;email@host.com&gt;
sub   1024R/28847259 2012-09-13
sig          E4EFB2B4 2012-09-13  Tiberiu (This is my GPG key) &lt;email@host.com&gt;

pub   1024R/8FA52AD1 2012-09-13
uid                  Bob Michael &lt;bob@michael.com&gt;
sig 3        8FA52AD1 2012-09-13  Bob Michael &lt;bob@michael.com&gt;
sig          ECB916DC 2012-09-13  Tiberiu (This is my GPG key) &lt;email@host.com&gt;
sub   1024R/2786E92D 2012-09-13
sig          8FA52AD1 2012-09-13  Bob Michael &lt;bob@michael.com&gt;</code></pre>
<p>After signing he only has to send his new signed key to all his friends or to a public server.</p>
<p>GnuPG also offer the possibility to send not only encrypted messages to our friends – because sometimes it is not a must to secure out communication –, but signed only. Though the message is clear, it should be signed to confirm the authentication feature provided by GPG. You must be sure that the receiver can trust the content and it comes from a reliable source. We can do this as follows:</p>
<pre><code>tibi@tbarbu-pc:~$ echo &quot;Hello world. This is a plaintext&quot; &gt; clear_message.txt
gpg --clearsign clear_message.txt</code></pre>
<p>A new file <code>clear_message.txt.asc</code> is created, containing the following:</p>
<pre><code>tibi@tbarbu-pc:~$ cat clear_message.txt.asc
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello world. This is a plaintext
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iJwEAQECAAYFAlBW5u8ACgkQo0DCbuy5FtxmiAQApRWX9/D48NnX8OEVzf4rrCFw
agE5U/0MUyp5zLTU6o1pM3Oj5qDrJCeUjmHfworLFw/rGy5wcfU0S6plgWmvrZMZ
roT/qVfAyNwDijRZb/INy8UEBd9am+8LyCjC1pJgKv5HqBbvyDNYTcB/EBa2YjUU
5iP5s3AbfsA0Gb5by30=
=Mrjv
-----END PGP SIGNATURE-----</code></pre>
<p>As you can see the message is signed and the authenticity can be verified:</p>
<pre><code>alice@home:~$ gpg --verify clear_message.txt.asc
gpg: Signature made Mon 17 Sep 2012 12:01:35 PM EEST using RSA key ID ECB916DC
gpg: Good signature from &quot;Tiberiu (This is my GPG key) &lt;email@home.com&gt;&quot;</code></pre>
<p><a href="http://www.youtube.com/watch?v=gBzJGckMYO4">That’s all folks</a>. Thank you and I hope you find this guide useful.</p>
</section>

    </div>
  </div>
</div>

<!-- Social Buttons here -->
<div id="sociallinks">
  <a href="https://twitter.com/home?status=/from-0-to-cryptography.html" target="_blank">Tweet this</a> -
  <a href="http://www.facebook.com/sharer/sharer.php?u=/from-0-to-cryptography.html" target="_blank">Like this</a> -
  <a href="https://plus.google.com/share?url=/from-0-to-cryptography.html" target="_blank">Share on G+</a>
</div>

<script>
  (function(){window.addEventListener("DOMContentLoaded",function(){
    //get URL
    var url=document.location;
    var links=document.getElementById("sociallinks")
                      .getElementsByTagName('a');
    for (var i=0;i!=links.length;i++){
      // Replacing /from-0-to-cryptography.html with current URL
      links[i].setAttribute("href",links[i].href.replace('/from-0-to-cryptography.html',url));
    }})})();
</script>
</br>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'rosedutechblog';
  var disqus_url = window.location.href.split('/').splice(0,3).join("/")+'/from-0-to-cryptography.html';
  var title = 'From 0 to cryptography';
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

              </article>
            </div>
          </div>
        </div>
      </div>

      <footer class="the-footer">
        <div class="unit-foot">
          <div class="unit-inner unit-foot-inner">
            <div class="misc vcard">
              <h4>Social</h4>
              <div class="rss">
                <a href="http://techblog.rosedu.org/rss.xml" target="_blank">
                  <img src="./images/rss.png" alt="Subscribe to RSS Feed" />
                </a>
                <a href="http://www.reddit.com/submit?url='+encodeURIComponent(window.location)" target="_blank" onclick="window.location='http://www.reddit.com/submit?url='+encodeURIComponent(window.location); return false">
                  <img src="./images/reddit.png" alt="Submit to Reddit" />
                </a>
                <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" target="_blank">
                  <img src="./images/twitter.png" alt="Submit to Twitter" />
                </a>
              </div>

              <h4>Powered by</h4>
              <ul>
                <li class="contact">
                  <address>
                    <a class="author fn n" href="http://www.rosedu.org">ROSEdu</a>
                  </address>
                </li>
                <li class="contact">
                  <address>
                    <a class="author fn n" href="http://jaspervdj.be/hakyll">Hakyll</a>
                  </address>
                </li>
              </ul>

              <h4>License</h4>
              <div class="bucket">
                <span>
                  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons Attribution 3.0 License">
                    <img src="//i.creativecommons.org/l/by/3.0/88x31.png" alt="License">
                  </a>
                </span>
                <span>
                  This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/" class="subfoot">Creative Commons Attribution 3.0 License</a>.
                </span>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>
